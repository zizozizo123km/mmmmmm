<!DOCTYPE html>
<html>
<head>
  <title>مشاهدة أفلام IPTV</title>
</head>
<body>
  <h1>قائمة القنوات</h1>
  <div id="channels"></div>
  <video id="player" width="640" height="360" controls></video>

  <script>
    fetch('proxy.php')
      .then(res => res.text())
      .then(data => {
        const lines = data.split('\n');
        const channelsDiv = document.getElementById('channels');
        for (let i = 0; i < lines.length; i++) {
          if (lines[i].startsWith('#EXTINF')) {
            const name = lines[i].split(',')[1];
            const url = lines[i + 1];
            const btn = document.createElement('button');
            btn.textContent = name;
            btn.onclick = () => {
              const player = document.getElementById('player');
              player.src = 'stream.php?url=' + encodeURIComponent(url);
              player.play();
            };
            channelsDiv.appendChild(btn);
            i++;
          }
        }
      });
  </script>
</body>
</html>
